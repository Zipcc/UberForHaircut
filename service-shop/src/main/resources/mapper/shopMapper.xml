<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bristol.project.dao.ShopDao">

    <insert id="create" parameterType="Shop" useGeneratedKeys="true" keyProperty="id">
        insert into shop(username, shopName, locationDescription,
                         serviceForGender, phoneNumber)
        values(#{username},#{shopName},#{locationDescription},
               #{serviceForGender},#{phoneNumber});
    </insert>

    <delete id="deleteShopByUsername">
        delete from shop
        where username=#{username} and length(username)=length(#{username});
    </delete>

    <!--       <parameterMap id="shopWithServices" type="com.bristol.project.entity.Shop">
            <parameter property="id" jdbcType="BIGINT"/>
            <parameter property="username" jdbcType="VARCHAR"/>
            <parameter property="shopName" jdbcType="VARCHAR"/>
            <parameter property="locationDescription" jdbcType="VARCHAR"/>
            <parameter property="serviceForGender" jdbcType="VARCHAR"/>
            <parameter property="ratePoints" jdbcType="VARCHAR"/>
            <parameter property="phoneNumber" jdbcType="VARCHAR"/>
            <parameter property="shopServices" javaType="com.bristol.project.entity.ShopS/>
        </parameterMap>


        <resultMap type="net.biancheng.po.User" id="userAndOrder2">
            <id property="id" column="id" />
            <result property="name" column="name" />
            <result property="pwd" column="pwd" />
            &lt;!&ndash; 一对多级联查询，ofType表示集合中的元素类型 &ndash;&gt;
            <collection property="orderList"
                        ofType="net.biancheng.po.Order">
                <id property="oId" column="oId" />
                <result property="ordernum" column="ordernum" />
            </collection>
        </resultMap>
    -->
    <update id="updateShopByUsername" parameterType="Shop">
        update shop, shop_service
        set shop_name=#{shopName},location_description=#{locationDescription},
            service_for_gender=#{serviceForGender},service_name=#{serviceName},
            description=#{description}
        where shop.id=shop_service.shop_id and username=#{username};
    </update>


    <select id="getShopByShopName" resultType="Shop">
        select * from shop
        where shop_name=#{shopName} and length(shop_name)=length(#{shopName});
    </select>


    <select id="getShopByUsername" resultMap="shopWithService">
        select * from shop
        where username=#{username} and length(username)=length(#{username});
    </select>
    <resultMap id="shopWithService" type="Shop" >
        <collection property="shopServices" javaType="ArrayList" ofType="ShopService" select="getShopServiceByShopId" column="id"/>
    </resultMap>
    <select id="getShopServiceByShopId" resultType="ShopService">
        select * from shop_service
        where shop_id = #{id}
    </select>


    <select id="getAllShop" resultType="Shop">
        select * from shop;
    </select>

</mapper>